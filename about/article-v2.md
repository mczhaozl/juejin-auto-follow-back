# 我被测试甩锅后，用 GitHub Actions 做了个自动化工具

## 故事要从一次甩锅说起

去年有段时间，我负责的项目要给客户内网部署。

有一天，客户那边反馈说「有个功能不对」，售前拉了个群，问我们：现在他们内网跑的前端，到底是哪一版？

我懵了。

我能想到的只有：查 Jenkins 构建时间、看发版记录、让运维对一下包名……但客户环境我们进不去，他们也不会给你看构建日志。

最后只能靠「大概是上周三那版」「你让那边清个缓存再试试」这种话术硬撑。沟通成本高到离谱，而且心里根本没底。

更绝的是后来有一次：

测试同学部署错了包（把旧的打上去了），然后报 bug 说「前端有问题」。

我查了半天代码，逻辑没问题，就跟测试说：会不会是部署的包不对？

测试一口咬定：**就是你给的包有问题。**

我反复确认过发版记录、构建时间、包名，自己这边真的没弄错。但测试就是不信，坚持说是我的包有问题。

后来还专门开了个会，会上点名说「前端发的包有问题、导致测试环境异常」。

我解释了半天「很可能是部署错了包」，但没有证据，谁也说不清。

**最后只能吃哑巴亏。**

从那以后我就想：要是打开页面就能看到「这份代码是谁、什么时候打的」，下次谁再说是我的包有问题，我直接把证据拍桌上。

## 我试过的笨办法

一开始我试过在代码里手写版本号：

```javascript
window.version = 'v1.2.3';  // 每次发版自己改
```

结果要么忘改，要么改错分支，上线后发现 version 还是上一版的，等于白写。

也试过用 CI 环境变量在构建时注入，但有的项目没有 Jenkins、有的用别的 CI，配置不统一，换一个项目又得搞一遍，心累。

我就想：**能不能在打包的时候，自动把 Git 信息塞进代码里？**

这样既不用记着改，也不依赖某一种 CI，只要是从 Git 打的包，就有「身份证」。

## 然后我发现了 GitHub Actions

前段时间刷掘金，看到有人用 GitHub Actions 做自动签到，每天早上还能收到微信推送。

我一看：**这不就是现成的免费定时任务平台吗？**

作为程序员，我每天都要处理各种定时任务：
- 公司项目的数据爬取、报表生成
- 个人项目的签到、监控
- 还有各种琐碎的自动化需求

之前这些任务都跑在自己电脑上：
- 领导总说要熄屏省电，下班了还得关机
- 第二天来了，发现昨晚的任务根本没跑……

云服务器倒是稳定，但一个月几十块，跑个小任务有点浪费。

**GitHub Actions 完全免费，公共仓库不限时长，私有仓库每月 2000 分钟。**

我算了一下，我现在跑了好几个定时任务，每月才用 400 分钟。

于是我开始用 GitHub Actions 做各种自动化：

### 第一步：自动签到

每天早上 8 点自动签到领矿石，再也不用担心漏签。

### 第二步：数据监控

监控商品价格，降价自动通知；检查服务器健康状态；定时备份重要数据。

### 第三步：社交自动化

在掘金写文章后，经常有朋友关注我。按照社交礼仪，应该回关表示感谢。

但每次都要手动操作，有时候忙起来就忘了……

作为程序员，怎么能容忍这种重复劳动？

于是我也用 GitHub Actions 做了个自动回关的小工具。

## GitHub Actions 到底是什么？

简单来说，它就是一个**云端的自动化执行平台**。

你写一个 YAML 文件，告诉它：
- 什么时候执行（定时、代码推送、手动触发）
- 执行什么（运行脚本、调用 API、发送通知）

然后它就会在 GitHub 的服务器上自动跑。

### 为什么这么香？

**1. 完全免费**
- 公共仓库：不限时长
- 私有仓库：每月 2000 分钟
- 我现在跑了好几个任务，每月才用 400 分钟

**2. 稳定可靠**
- GitHub 的基础设施，24/7 运行
- 不用担心断电、断网、重启
- 比自己的电脑靠谱多了

**3. 配置简单**
- 一个 YAML 文件搞定
- 不需要额外的服务器
- 不需要复杂的运维知识

**4. 安全性高**
- GitHub Secrets 加密存储敏感信息
- 日志自动屏蔽密钥
- 即使仓库公开，密钥也不会泄露

## 怎么用？三步搞定

### 第一步：创建 workflow 文件

在仓库根目录创建 `.github/workflows/task.yml`：

```yaml
name: 自动化任务

on:
  schedule:
    - cron: '0 * * * *'  # 每小时执行一次
  workflow_dispatch:  # 允许手动触发

jobs:
  run-task:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout 代码
        uses: actions/checkout@v4

      - name: 设置 Python 环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: 安装依赖
        run: pip install requests

      - name: 执行脚本
        run: python scripts/task.py
        env:
          MY_SECRET: ${{ secrets.MY_SECRET }}
```

### 第二步：写脚本

创建 `scripts/task.py`：

```python
import os
import requests
from datetime import datetime

def main():
    # 从环境变量读取密钥
    secret = os.getenv('MY_SECRET')
    
    # 执行你的任务
    print(f"开始执行任务 - {datetime.now()}")
    
    # 比如：调用 API、爬取数据、发送通知等
    # ...
    
    print("任务执行完成！")

if __name__ == "__main__":
    main()
```

### 第三步：配置密钥

1. 进入仓库 Settings → Secrets → New secret
2. 添加 `MY_SECRET`（比如 Cookie、Token）
3. 保存

**搞定！** 🎉

推送代码后，GitHub Actions 就会按照你设置的时间自动执行。

## 我用它做了什么？

### 1. 每日签到

每天早上 8 点自动签到领矿石，再也不用担心漏签。

### 2. 自动回关

有人关注我，一小时内自动回关。再也不用担心忘记回关了。

### 3. 价格监控

监控商品价格，降价自动发微信通知。

### 4. 服务监控

定时检查服务器健康状态，挂了立即提醒。

### 5. 定时备份

每天自动备份数据库到云盘。

所有这些任务，都在 GitHub 上稳定运行，完全不用操心！

## 定时任务怎么设置？

GitHub Actions 使用 cron 表达式来设置定时任务。

### 基本格式

```
* * * * *
│ │ │ │ │
│ │ │ │ └─── 星期几 (0-6)
│ │ │ └───── 月份 (1-12)
│ │ └─────── 日期 (1-31)
│ └───────── 小时 (0-23)
└─────────── 分钟 (0-59)
```

### 常用示例

```yaml
# 每小时执行一次
- cron: '0 * * * *'

# 每天早上 8 点（注意：GitHub 用 UTC 时间，北京时间要 -8）
- cron: '0 0 * * *'

# 每 2 小时执行一次
- cron: '0 */2 * * *'

# 每周一早上 9 点
- cron: '0 1 * * 1'
```

**注意**：GitHub Actions 使用 UTC 时间，北京时间需要 -8 小时！

推荐使用 [crontab.guru](https://crontab.guru/) 来生成和验证表达式。

## 成本分析：真的免费吗？

让我算一笔账：

**我的使用情况**：
- 签到任务：每天 1 次，每次 20 秒
- 自动回关：每小时 1 次，每次 30 秒
- 数据监控：每 2 小时 1 次，每次 15 秒

**每月总耗时**：
- 签到：30 天 × 20 秒 = 10 分钟
- 回关：30 天 × 24 次 × 30 秒 = 360 分钟
- 监控：30 天 × 12 次 × 15 秒 = 90 分钟
- **合计：约 460 分钟**

GitHub 免费账户每月 2000 分钟，我只用了 460 分钟，还剩 1540 分钟。

**如果用云服务器**：
- 最便宜的云服务器：约 50 元/月
- GitHub Actions：**0 元/月**

**完全免费，零成本！**

## 还能做什么？

只要是定时任务，都可以用 GitHub Actions 来做：

### 自动签到系列
- 掘金签到、CSDN 签到、各种平台签到
- 再也不用担心漏签

### 数据监控系列
- 价格监控：商品降价自动通知
- 库存监控：抢购商品有货立即提醒
- 网站监控：服务挂了立即通知

### 自动化运维
- 定时备份：数据库、文件自动备份
- 健康检查：定时 ping 服务器
- 日志清理：定期清理过期日志

### 内容聚合
- RSS 订阅：定时抓取博客更新
- 热榜聚合：每天汇总各大平台热榜
- 文章推送：关注的作者发新文章自动推送

## 常见问题

### 1. 为什么我的定时任务没执行？

可能原因：
- 仓库长期没活动，GitHub 会自动禁用
- cron 表达式写错了
- workflow 文件语法错误

解决方法：
- 定期（每 60 天）手动触发一次
- 用 [crontab.guru](https://crontab.guru/) 验证表达式
- 在 Actions 页面查看错误日志

### 2. 定时任务不准时怎么办？

GitHub Actions 的定时任务可能会延迟 3-10 分钟，这是正常现象。

如果需要精确定时，建议提前几分钟执行。

### 3. 如何查看执行日志？

进入仓库 → Actions 标签页 → 点击对应的 workflow → 查看运行记录。

### 4. 密钥安全吗？

非常安全：
- Secret 添加后无法查看，只能更新或删除
- 日志中自动屏蔽 Secret 内容（显示为 `***`）
- Fork 的仓库不会复制 Secret

## 最佳实践建议

### 1. 从简单开始

先实现一个简单的签到脚本，熟悉 GitHub Actions 的基本用法。

### 2. 添加错误处理

```python
try:
    # 执行任务
    result = do_something()
    print(f"成功: {result}")
except Exception as e:
    print(f"失败: {e}")
    # 可以发送通知
```

### 3. 记录日志

方便查看运行情况，排查问题。

### 4. 注意频率

不要设置过高的执行频率，避免给平台造成压力。

### 5. 保护隐私

敏感信息一定要用 GitHub Secrets 存储，不要硬编码在代码里。

## 现在的效果

现在再有人说「你的包有问题」，我可以直接打开页面：
- 这是 main 分支
- Commit: abc123
- 打包时间：2024-01-15 10:30

**谁也别想甩锅给我。**

而且我的各种定时任务都跑在 GitHub 上：
- 电脑关机也不怕
- 服务器也不用买
- 省心又省钱

## 开源分享

我把这些自动化工具都开源了，欢迎使用：

**GitHub 仓库**：[juejin-auto-follow-back](https://github.com/mczhaozl/juejin-auto-follow-back)

包含功能：
- ✅ 掘金每日自动签到
- ✅ 自动回关新粉丝
- ✅ 完整的使用文档

配置很简单，三步搞定：
1. Fork 仓库
2. 添加 Cookie 到 Secrets
3. 启用 Actions

如果这个工具帮到了你，欢迎点赞、收藏、关注三连！有问题也欢迎在评论区交流 🎉

## 写在最后

作为程序员，我们的目标就是：**能自动化的绝不手动，能偷懒的绝不勤快！**

从最初被测试甩锅，到现在用 GitHub Actions 实现各种自动化，我深刻体会到：
- 工具是为了提高效率
- 自动化是为了解放双手
- 开源是为了帮助更多人

希望这篇文章能给你带来启发。如果你也有类似的需求，不妨试试 GitHub Actions，说不定会打开新世界的大门！

对了，最近我在掘金上写文章，经常收到朋友们的关注。为了表示感谢，我都会回关。

不过有时候工作忙起来，可能会忘记及时回关。所以我也用 GitHub Actions 做了个小工具，**每小时自动检查一次**。

如果你关注了我，最多一小时就能收到回关。不信的话，可以试试看 😄

---

**参考文章**：
- [🎉 几行代码实现掘金自动签到+微信推送 再也不怕漏签了](https://juejin.cn/post/7021027165294559245) - 感谢 @Bi8bo 的启发

**相关资源**：
- [GitHub Actions 官方文档](https://docs.github.com/en/actions)
- [Cron 表达式生成器](https://crontab.guru/)
